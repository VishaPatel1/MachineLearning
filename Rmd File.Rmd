---
title: "Machine Learning Project"
author: "Visha Patel"
date: "7/31/2021"
output: html_document
---

## Overview

This analysis will use a training set in which individuals were asked to do exercises correctly and incorrectly. Using information from the test set, I will build a  model that will predict weather individuals correctly or incorrectly did the same exercises in a test set. This analysis is separated into multiple sections: 


## Loading and cleaning datasets

We first need to get rid of the NAs and irrelevant columns. 
```{r setup, messages = F, warning= F}
# Loading the correct packages and dataset
library(data.table)
library(readxl)
library(dplyr)
library(caret)
training <- read.table(file = "./pml-training.csv", "," , header = T)
validation <- read.table(file = "./pml-testing.csv", "," , header = T)

# Get rid of the first seven columns because they are just user information that is irrelevant. 
training <- training[,8:160]
validation <- validation[,8:160]
training$classe <- as.factor(training$classe)

# Several columns have NA's as well. 
colname <- colnames(training)[(colSums(!is.na(training)))/19622 > .95]
colname <- colname[-86]
training <- training %>% select(colname, classe)
validation <- validation %>% select(colname,problem_id)
nzv <- nearZeroVar(training)
training <- training[,-nzv]
validation <- validation[,-nzv]

## Let's split the training test set once more, so we can try mutiple models before chosing a final one. 
inTrain <- createDataPartition(y=training$classe,p=0.7, list=FALSE)
training <- training[inTrain,]
test <- training[-inTrain,]


```

## Decision Tree

Let's see how a decision tree might work. 
```{r, messages = F, warning= F}
library(rpart)
library(rattle)
library(rpart.plot)
library(RColorBrewer)
model1 <- rpart(classe ~., data = training, method = "class")
fancyRpartPlot(model1, caption = NULL)
##Let's predict on the test set now to see how well this prediction model fits.
predict_model1 <- predict(model1, newdata = test, type= "class")
confusionMatrix(predict_model1, test$classe)
```

## Random Forest Model 
Next, I will run a random forest model. 

```{r, messages = F, warning= F}
library(randomForest)
model2 <- train(classe ~., data = training, method = "rf")
##Let's predict on the test set now to see how well this prediction model fits.
predict_model2 <- predict(model2, newdata = test)
confusionMatrix(predict_model2, test$classe)
```

## GLM Model 
Lastly, I will run a generalized linear model. 
```{r, messages = F, warning= F}
library(gbm)
model3 <- train(classe ~., data = training, method = "gbm")
##Let's predict on the test set now to see how well this prediction model fits.
predict_model3 <- predict(model3, newdata = test)
confusionMatrix(predict_model3, test$classe)
```

## Final Prediction
The accuracy of each test is the following: Decision Tree (74%), RainForest (100%), and GBM(98%). 
Based on this I will run the model 2 on the validation set.

```{r, messages = F, warning= F}
final_prediction <- predict(model2 , newdata=validation)
final_prediction
```


